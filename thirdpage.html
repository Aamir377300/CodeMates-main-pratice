<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Revision Planner</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script> <!-- Include SheetJS -->
  <style>
    /* Basic Styles for layout and buttons */
    body {
        font-family: Arial, sans-serif;
    }

    .form-container {
        width: 80%;
        margin: auto;
    }

    .form-container h1 {
        text-align: center;
    }

    .sections {
        display: flex;
        justify-content: space-between;
    }

    .section {
        width: 30%;
        padding: 10px;
        border-radius: 10px;
    }

    .topic-box {
        margin: 10px;
        padding: 10px;
        border: 1px solid #ccc;
    }

    .actions {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
    }

    .correct-btn, .wrong-btn {
        padding: 5px 10px;
        cursor: pointer;
    }

    #topics-table {
        margin-top: 20px;
    }

    #backlog-list {
        border: 3px solid red; /* Red border for Backlog */
    }

    #completed-list {
        border: 3px solid green; /* Green border for Completed */
    }

    .backlog {
        background-color: #f7d6d6;
    }

    .completed {
        background-color: #d1f7d1;
    }
  </style>
</head>
<body>
  <div class="form-container">
    <h1>Revision Planner</h1>

    <!-- Topics Button at the top-right -->
    <button id="topics-button" style="position: absolute; top: 20px; right: 20px;">Topics</button>

    <!-- Table for Topics (Hidden initially) -->
    <div id="topics-table" style="display: none;">
      <h2>Topics List</h2>
      <table border="1">
        <thead>
          <tr>
            <th>Topic Name</th>
            <th>Last Revision Date</th>
            <th>Review Count</th>
          </tr>
        </thead>
        <tbody id="topics-list"></tbody>
      </table>
      <button id="export-excel">Export to Excel</button>
    </div>

    <!-- Horizontal sections for Topics, Backlog, and Completed -->
    <div class="sections">
      <div class="section" id="topics-section">
        <h2>Topics</h2>
        <div id="topic-list"></div>
      </div>
      <div class="section" id="backlog-section">
        <h2>Backlog</h2>
        <div id="backlog-list"></div>
      </div>
      <div class="section" id="completed-section">
        <h2>Completed</h2>
        <div id="completed-list"></div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const topics = JSON.parse(localStorage.getItem("topics")) || [];
      const intervals = [1, 3, 7, 14, 30];
      const topicList = document.getElementById("topic-list");
      const backlogList = document.getElementById("backlog-list");
      const completedList = document.getElementById("completed-list");

      function updateLocalStorage() {
        localStorage.setItem("topics", JSON.stringify(topics));
      }

      function addTopicBox(topic, container, status) {
        const topicBox = document.createElement("div");
        topicBox.classList.add("topic-box");

        // Set background color based on status
        if (status === 'correct') {
          topicBox.style.backgroundColor = "#b6fcb6"; // Green background for correct
        } else if (status === 'wrong') {
          topicBox.style.backgroundColor = "#fcb6b6"; // Red background for wrong
        }

        const topicName = document.createElement("p");
        topicName.textContent = topic.name;
        topicBox.appendChild(topicName);

        let lastRevisionDate = new Date(topic.lastRevisionDate || new Date());
        let nextReviewDate = new Date(lastRevisionDate);
        let intervalIndex = Math.min(topic.reviewCount, intervals.length - 1);
        nextReviewDate.setDate(lastRevisionDate.getDate() + intervals[intervalIndex]);

        const actions = document.createElement("div");
        actions.classList.add("actions");

        const nextReviewText = document.createElement("span");
        nextReviewText.textContent = `Next review: ${nextReviewDate.toLocaleDateString()}`;
        actions.appendChild(nextReviewText);

        const correctButton = document.createElement("button");
        correctButton.textContent = "✔️";
        correctButton.classList.add("correct-btn");
        correctButton.onclick = function () {
          // Move topic to completed after first correct click
          if (container === backlogList || container === topicList) {
            topic.reviewCount = Math.min(topic.reviewCount, intervals.length - 1); // Keep the review count
            topic.lastRevisionDate = new Date().toISOString(); // Update last revision date
            container.removeChild(topicBox);
            completedList.appendChild(topicBox);
            topicBox.style.backgroundColor = "#b6fcb6"; // Mark completed topics with green background
            topicBox.classList.add("completed"); // Add 'completed' class to signify it's completed
            updateLocalStorage(); // Save updated topic state
          }
        };

        const wrongButton = document.createElement("button");
        wrongButton.textContent = "❌";
        wrongButton.classList.add("wrong-btn");
        wrongButton.onclick = function () {
          topic.reviewCount = 0;
          topic.lastRevisionDate = new Date().toISOString();
          container.removeChild(topicBox);
          backlogList.appendChild(topicBox);
          topicBox.style.backgroundColor = "#fcb6b6"; // Mark wrong topics with red background
          updateLocalStorage(); // Save updated topic state
        };

        actions.appendChild(correctButton);
        actions.appendChild(wrongButton);
        topicBox.appendChild(actions);

        // Remove correct and wrong buttons for completed section
        if (container === completedList) {
          actions.removeChild(correctButton);
          actions.removeChild(wrongButton);
        }

        // Remove wrong button for backlog section
        if (container === backlogList) {
          actions.removeChild(wrongButton);
        }

        // Add the correct class to the backlog or completed container
        if (container === backlogList) {
          topicBox.classList.add("backlog");
        } else if (container === completedList) {
          topicBox.classList.add("completed");
        }

        container.appendChild(topicBox);
      }

      // Add topics to initial list
      topics.forEach((topic) => addTopicBox(topic, topicList, ''));

      // Show topics table on button click
      document.getElementById("topics-button").addEventListener("click", function () {
        const topicsTable = document.getElementById("topics-table");
        const topicsList = document.getElementById("topics-list");
        topicsList.innerHTML = "";
        topics.forEach((topic) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${topic.name}</td>
            <td>${topic.lastRevisionDate}</td>
            <td>${topic.reviewCount}</td>
          `;
          topicsList.appendChild(row);
        });
        topicsTable.style.display = "block";
      });

      // Export topics to Excel
      document.getElementById("export-excel").addEventListener("click", function () {
        const excelData = topics.map((t) => ({
          "Topic Name": t.name,
          "Last Revision Date": t.lastRevisionDate,
          "Review Count": t.reviewCount,
        }));
        const ws = XLSX.utils.json_to_sheet(excelData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Topics");
        XLSX.writeFile(wb, "topics.xlsx");
      });
    });
  </script>
</body> 
</html>